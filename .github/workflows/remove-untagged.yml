name: Cleanup Untagged Images

on:
  # every sunday at 02:00
  # schedule:
  #   - cron: '0 2 * * 0'
  # or manually
  workflow_dispatch:

env:
  # Use docker.io for Docker Hub if empty
  REGISTRY: ghcr.io
  # github.repository as <account>/<repo>
  ORG: ${{ github.repository_owner }}

jobs:
  delete-untagged-images:
    name: Delete Untagged Images
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
      # This is used to complete the identity challenge
      # with sigstore/fulcio when running outside of PRs.
      id-token: write
    strategy:
      matrix:
        image-name: ["idoml-python", "idoml-python-pytorch"]

    steps:
      - uses: actions/delete-package-versions@v5
        with: 
          package-name: ${{ matrix.image-name }}
          package-type: 'container'
          min-versions-to-keep: 0
          delete-only-untagged-versions: 'true'